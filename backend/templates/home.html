<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Home - TranscribeFlow</title>

    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@300;400;500;600;700&family=Outfit:wght@400;600;800;900&display=swap"
        rel="stylesheet">

    <!-- Material Symbols -->
    <link rel="stylesheet"
        href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght,FILL@100..700,0..1&display=swap" />

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Custom CSS -->
    <link href="/static/css/style.css" rel="stylesheet" />

    <!-- Clerk SDK -->
    <script async crossorigin="anonymous"
        data-clerk-publishable-key="pk_test_dXNlZnVsLWNoZWV0YWgtMzguY2xlcmsuYWNjb3VudHMuZGV2JA"
        src="https://cdn.jsdelivr.net/npm/@clerk/clerk-js@latest/dist/clerk.browser.js" type="text/javascript"></script>

    <!-- Notification System -->
    <script src="/static/js/notifications.js"></script>
</head>

<body class="antialiased mesh-gradient-bg min-h-screen">

    <!-- Navigation -->
    <nav class="fixed top-0 w-full z-50 glass-panel border-b border-white/10">
        <div class="max-w-[1600px] mx-auto px-6 h-16 flex items-center justify-between">
            <div class="flex items-center gap-3 group cursor-pointer" onclick="window.location.href='/'">
                <div
                    class="w-8 h-8 bg-gradient-to-br from-[#00f2ff] via-[#bc13fe] to-[#00ffc3] rounded flex items-center justify-center shadow-[0_0_15px_rgba(0,242,255,0.4)]">
                    <span class="material-symbols-outlined text-white text-xl font-bold">graphic_eq</span>
                </div>
                <span class="text-xl font-black tracking-tighter italic">Transcribe<span
                        class="text-[#00f2ff]">Flow</span> <span
                        class="text-xs uppercase tracking-[0.2em] font-bold text-slate-500 ml-2">Studio</span></span>
            </div>
            <div class="hidden md:flex items-center gap-8">
                <a class="text-[10px] font-black tracking-[0.2em] uppercase text-[#00f2ff]" href="/home">Home</a>
                <a class="text-[10px] font-black tracking-[0.2em] uppercase text-slate-400 hover:text-white transition-colors"
                    href="/upload-page">Upload</a>
                <a class="text-[10px] font-black tracking-[0.2em] uppercase text-slate-400 hover:text-[#bc13fe] transition-colors"
                    href="/history-page">History</a>
                <a class="text-[10px] font-black tracking-[0.2em] uppercase text-slate-400 hover:text-[#00ffc3] transition-colors"
                    href="/profile">Profile</a>
            </div>
            <div class="flex items-center gap-6">
                <!-- User Profile (clickable) -->
                <a href="/profile" id="user-profile"
                    class="flex items-center gap-3 px-3 py-2 rounded-full bg-white/5 border border-white/10 hover:border-[#00f2ff]/30 hover:bg-white/10 transition-all cursor-pointer">
                    <div
                        class="w-8 h-8 rounded-full bg-gradient-to-br from-[#00f2ff] to-[#bc13fe] flex items-center justify-center">
                        <span class="material-symbols-outlined text-white text-lg">person</span>
                    </div>
                    <span id="user-name-nav" class="text-xs font-bold text-white">Loading...</span>
                </a>
                <!-- Sign Out Button -->
                <button id="signout-btn"
                    class="flex items-center gap-2 px-4 py-2 rounded-full bg-red-500/10 border border-red-500/30 hover:bg-red-500/20 transition-colors">
                    <span class="material-symbols-outlined text-red-400 text-sm">logout</span>
                    <span class="text-[10px] font-black uppercase tracking-widest text-red-400">Sign Out</span>
                </button>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="pt-24 pb-12 px-6 max-w-[1400px] mx-auto">

        <!-- Welcome Banner -->
        <div class="glass-panel p-8 rounded-3xl border border-[#00f2ff]/30 mb-8 relative overflow-hidden">
            <div class="absolute top-0 right-0 w-64 h-64 bg-[#00f2ff]/10 rounded-full blur-[100px]"></div>
            <div class="absolute bottom-0 left-0 w-64 h-64 bg-[#bc13fe]/10 rounded-full blur-[100px]"></div>
            <div class="relative z-10">
                <h1 class="text-4xl font-black mb-2">Welcome Back, <span id="user-name"
                        class="text-[#00f2ff]">User</span>! ðŸŽµ</h1>
                <p class="text-slate-400 text-lg">Your AI transcription command center is ready to flow.</p>
            </div>
        </div>

        <!-- Stats Overview -->
        <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
            <div class="glass-panel p-6 rounded-2xl border border-white/10 hover:border-[#00f2ff]/30 transition-all">
                <div class="flex items-center justify-between mb-4">
                    <span class="material-symbols-outlined text-[#00f2ff] text-4xl">upload_file</span>
                    <span class="text-3xl font-black text-white" id="total-uploads">0</span>
                </div>
                <p class="text-sm font-bold uppercase tracking-widest text-slate-400">Total Uploads</p>
            </div>
            <div class="glass-panel p-6 rounded-2xl border border-white/10 hover:border-[#bc13fe]/30 transition-all">
                <div class="flex items-center justify-between mb-4">
                    <span class="material-symbols-outlined text-[#bc13fe] text-4xl">timer</span>
                    <span class="text-3xl font-black text-white"><span id="total-minutes">0</span>m</span>
                </div>
                <p class="text-sm font-bold uppercase tracking-widest text-slate-400">Total Minutes</p>
            </div>
            <div class="glass-panel p-6 rounded-2xl border border-white/10 hover:border-[#00ffc3]/30 transition-all">
                <div class="flex items-center justify-between mb-4">
                    <span class="material-symbols-outlined text-[#00ffc3] text-4xl">verified</span>
                    <span class="text-3xl font-black text-white"><span id="avg-confidence">0</span>%</span>
                </div>
                <p class="text-sm font-bold uppercase tracking-widest text-slate-400">Avg Confidence</p>
            </div>
        </div>

        <!-- How It Works Section -->
        <div class="glass-panel p-8 rounded-3xl border border-white/10 mb-8">
            <h2 class="text-2xl font-black uppercase tracking-tight mb-6 flex items-center gap-3">
                <span class="material-symbols-outlined text-[#00f2ff]">rocket_launch</span>
                How It Works
            </h2>
            <div class="grid grid-cols-1 md:grid-cols-4 gap-6">
                <!-- Step 1 -->
                <div class="relative group">
                    <div
                        class="glass-panel p-6 rounded-2xl border border-[#00f2ff]/30 hover:border-[#00f2ff] transition-all hover:scale-105 transform">
                        <div class="w-16 h-16 bg-[#00f2ff]/20 rounded-xl flex items-center justify-center mb-4 mx-auto">
                            <span class="material-symbols-outlined text-[#00f2ff] text-3xl">cloud_upload</span>
                        </div>
                        <div class="text-center">
                            <div class="text-[#00f2ff] text-2xl font-black mb-2">01</div>
                            <h3 class="font-black uppercase text-sm mb-2">Upload Audio</h3>
                            <p class="text-xs text-slate-400">Drag & drop MP3, WAV, MP4 files up to 2GB</p>
                        </div>
                    </div>
                    <div class="hidden md:block absolute top-1/2 -right-3 transform -translate-y-1/2 text-[#00f2ff]/30">
                        <span class="material-symbols-outlined text-2xl">arrow_forward</span>
                    </div>
                </div>

                <!-- Step 2 -->
                <div class="relative group">
                    <div
                        class="glass-panel p-6 rounded-2xl border border-[#bc13fe]/30 hover:border-[#bc13fe] transition-all hover:scale-105 transform">
                        <div class="w-16 h-16 bg-[#bc13fe]/20 rounded-xl flex items-center justify-center mb-4 mx-auto">
                            <span class="material-symbols-outlined text-[#bc13fe] text-3xl">tune</span>
                        </div>
                        <div class="text-center">
                            <div class="text-[#bc13fe] text-2xl font-black mb-2">02</div>
                            <h3 class="font-black uppercase text-sm mb-2">Configure</h3>
                            <p class="text-xs text-slate-400">Choose language, enable speaker detection</p>
                        </div>
                    </div>
                    <div class="hidden md:block absolute top-1/2 -right-3 transform -translate-y-1/2 text-[#bc13fe]/30">
                        <span class="material-symbols-outlined text-2xl">arrow_forward</span>
                    </div>
                </div>

                <!-- Step 3 -->
                <div class="relative group">
                    <div
                        class="glass-panel p-6 rounded-2xl border border-[#00ffc3]/30 hover:border-[#00ffc3] transition-all hover:scale-105 transform">
                        <div class="w-16 h-16 bg-[#00ffc3]/20 rounded-xl flex items-center justify-center mb-4 mx-auto">
                            <span class="material-symbols-outlined text-[#00ffc3] text-3xl">auto_awesome</span>
                        </div>
                        <div class="text-center">
                            <div class="text-[#00ffc3] text-2xl font-black mb-2">03</div>
                            <h3 class="font-black uppercase text-sm mb-2">AI Processing</h3>
                            <p class="text-xs text-slate-400">Whisper transcription + GPT-4 summary</p>
                        </div>
                    </div>
                    <div class="hidden md:block absolute top-1/2 -right-3 transform -translate-y-1/2 text-[#00ffc3]/30">
                        <span class="material-symbols-outlined text-2xl">arrow_forward</span>
                    </div>
                </div>

                <!-- Step 4 -->
                <div class="group">
                    <div
                        class="glass-panel p-6 rounded-2xl border border-white/30 hover:border-white transition-all hover:scale-105 transform">
                        <div class="w-16 h-16 bg-white/20 rounded-xl flex items-center justify-center mb-4 mx-auto">
                            <span class="material-symbols-outlined text-white text-3xl">check_circle</span>
                        </div>
                        <div class="text-center">
                            <div class="text-white text-2xl font-black mb-2">04</div>
                            <h3 class="font-black uppercase text-sm mb-2">Get Results</h3>
                            <p class="text-xs text-slate-400">Transcript, summary, keywords, Sonic DNA</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
            <!-- Quick Actions -->
            <div class="glass-panel p-8 rounded-3xl border border-white/10">
                <h2 class="text-2xl font-black uppercase tracking-tight mb-6 flex items-center gap-3">
                    <span class="material-symbols-outlined text-[#00f2ff]">bolt</span>
                    Quick Actions
                </h2>
                <div class="space-y-4">
                    <a href="/upload-page" class="block group">
                        <div
                            class="glass-panel p-6 rounded-2xl border border-[#00f2ff]/30 hover:border-[#00f2ff] hover:bg-[#00f2ff]/5 transition-all">
                            <div class="flex items-center gap-4">
                                <div class="w-12 h-12 bg-[#00f2ff]/20 rounded-xl flex items-center justify-center">
                                    <span class="material-symbols-outlined text-[#00f2ff]">upload</span>
                                </div>
                                <div class="flex-1">
                                    <h3 class="font-black uppercase text-sm mb-1">New Upload</h3>
                                    <p class="text-xs text-slate-400">Start transcribing a new file</p>
                                </div>
                                <span
                                    class="material-symbols-outlined text-slate-400 group-hover:text-[#00f2ff] transition-colors">arrow_forward</span>
                            </div>
                        </div>
                    </a>
                    <a href="/history-page" class="block group">
                        <div
                            class="glass-panel p-6 rounded-2xl border border-[#bc13fe]/30 hover:border-[#bc13fe] hover:bg-[#bc13fe]/5 transition-all">
                            <div class="flex items-center gap-4">
                                <div class="w-12 h-12 bg-[#bc13fe]/20 rounded-xl flex items-center justify-center">
                                    <span class="material-symbols-outlined text-[#bc13fe]">history</span>
                                </div>
                                <div class="flex-1">
                                    <h3 class="font-black uppercase text-sm mb-1">View History</h3>
                                    <p class="text-xs text-slate-400">Browse all your transcripts</p>
                                </div>
                                <span
                                    class="material-symbols-outlined text-slate-400 group-hover:text-[#bc13fe] transition-colors">arrow_forward</span>
                            </div>
                        </div>
                    </a>
                    <a href="/profile" class="block group">
                        <div
                            class="glass-panel p-6 rounded-2xl border border-[#00ffc3]/30 hover:border-[#00ffc3] hover:bg-[#00ffc3]/5 transition-all">
                            <div class="flex items-center gap-4">
                                <div class="w-12 h-12 bg-[#00ffc3]/20 rounded-xl flex items-center justify-center">
                                    <span class="material-symbols-outlined text-[#00ffc3]">account_circle</span>
                                </div>
                                <div class="flex-1">
                                    <h3 class="font-black uppercase text-sm mb-1">Manage Profile</h3>
                                    <p class="text-xs text-slate-400">Update your account settings</p>
                                </div>
                                <span
                                    class="material-symbols-outlined text-slate-400 group-hover:text-[#00ffc3] transition-colors">arrow_forward</span>
                            </div>
                        </div>
                    </a>
                </div>
            </div>

            <!-- Recent Transcripts -->
            <div class="glass-panel p-8 rounded-3xl border border-white/10">
                <h2 class="text-2xl font-black uppercase tracking-tight mb-6 flex items-center gap-3">
                    <span class="material-symbols-outlined text-[#00f2ff]">description</span>
                    Recent Transcripts
                </h2>
                <div id="recent-transcripts" class="space-y-4">
                    <div class="text-center text-slate-400 py-8">
                        <span class="material-symbols-outlined text-4xl mb-2 block opacity-50">folder_open</span>
                        <p class="text-sm">No transcripts yet. Upload your first file!</p>
                    </div>
                </div>
            </div>
        </div>

    </main>

    <!-- Clerk Authentication -->
    <script>
        window.addEventListener("load", async function () {
            await Clerk.load();

            if (!Clerk.user) {
                window.location.href = '/';
                return;
            }

            // Display user name
            const userName = Clerk.user.firstName || Clerk.user.username || Clerk.user.primaryEmailAddress?.emailAddress || 'User';
            document.getElementById('user-name').textContent = userName;
            if (document.getElementById('user-name-nav')) {
                document.getElementById('user-name-nav').textContent = userName;
            }

            document.getElementById('signout-btn').addEventListener('click', async () => {
                await Clerk.signOut();
                window.location.href = '/';
            });

            // Load user stats
            loadUserStats();
            loadRecentTranscripts();
        });

        async function loadUserStats() {
            try {
                const response = await fetch('/history');
                const history = await response.json();

                // Calculate stats
                const totalUploads = history.length;
                const totalMinutes = history.reduce((sum, item) => {
                    return sum + (item.sonic_dna?.duration || 0);
                }, 0);
                const avgConfidence = history.length > 0
                    ? history.reduce((sum, item) => sum + (item.confidence_score || 0), 0) / history.length
                    : 0;

                // Display stats
                document.getElementById('total-uploads').textContent = totalUploads;
                document.getElementById('total-minutes').textContent = Math.round(totalMinutes / 60);
                document.getElementById('avg-confidence').textContent = Math.round(avgConfidence);
            } catch (error) {
                console.error('Error loading stats:', error);
            }
        }

        async function loadRecentTranscripts() {
            try {
                const response = await fetch('/history');
                const history = await response.json();

                const container = document.getElementById('recent-transcripts');

                if (history.length === 0) return;

                // Show latest 3
                const recent = history.slice(0, 3);

                container.innerHTML = recent.map(item => `
                    <a href="/details?id=${item.id}" class="block group">
                        <div class="glass-panel p-4 rounded-xl border border-white/10 hover:border-[#00f2ff]/30 hover:bg-white/5 transition-all">
                            <div class="flex items-center gap-3">
                                <div class="w-10 h-10 bg-[#00f2ff]/20 rounded-lg flex items-center justify-center">
                                    <span class="material-symbols-outlined text-[#00f2ff] text-sm">audio_file</span>
                                </div>
                                <div class="flex-1 min-w-0">
                                    <h3 class="font-bold text-sm truncate">${item.filename}</h3>
                                    <p class="text-xs text-slate-400">${new Date(item.timestamp).toLocaleString()}</p>
                                </div>
                                <span class="material-symbols-outlined text-slate-400 group-hover:text-[#00f2ff] transition-colors text-sm">arrow_forward</span>
                            </div>
                        </div>
                    </a>
                `).join('');
            } catch (error) {
                console.error('Error loading recent transcripts:', error);
            }
        }
    </script>
</body>

</html>